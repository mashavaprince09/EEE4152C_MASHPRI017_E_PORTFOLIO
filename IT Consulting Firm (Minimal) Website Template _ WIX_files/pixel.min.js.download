(()=>{var D=Object.defineProperty;var R=(r,t,e)=>t in r?D(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var H=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var z=(r,t,e)=>(R(r,typeof t!="symbol"?t+"":t,e),e),O=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var a=(r,t,e)=>(O(r,t,"read from private field"),e?e.call(r):t.get(r)),c=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)};var u=(r,t,e)=>(O(r,t,"access private method"),e);var m=H((X,P)=>{var b=class{constructor(t){this.schema=t}sanitize(t){return this.#t(t,this.schema)}#t(t,e){if(Array.isArray(e))return this.#n(t,e);if(e===String)return t?.toString();if(e===Number)return Number(t);if(e===Boolean)return!["0","false"].includes(t.toString());if(typeof e=="object")return this.#e(t,e);throw new Error(`Don't know how to sanitize ${typeof e} specified in schema`)}#e(t,e){return Object.keys(e).filter(n=>e.hasOwnProperty(n)&&t.hasOwnProperty(n)).reduce((n,i)=>(n[i]=this.#t(t[i],e[i]),n),{})}#n(t,e){if(e.length!==1)throw new Error("Schema arrays must contain exactly one type of field");return t.map(n=>this.#t(n,e[0]))}};P.exports=b});var L=H((k,q)=>{var S=m(),y,f,A,g,w,p,E,l,h,I,N,C,v,o=class{constructor(){c(this,l);c(this,I);c(this,C)}conf(t,e=!0){if(this.token&&this.token.length){console.log("MAI SDK already configured; skipping reconfiguration.");return}this.token=t,this.onboardingSync=e,this.debug=!1,this.ready=new Promise((n,i)=>{let s=new XMLHttpRequest;s.open("GET",`${o.PIXEL_HOST}/init`,!0),s.withCredentials=!0,s.onload=n,s.onerror=i,s.send()}),this.onboardingSync&&this.ready.then(()=>{let n=new Image;n.src=`${o.PIXEL_HOST}/pixel/sync.gif`})}identify(t){return u(this,l,h).call(this,"identify",{userId:t.toString()})}view(){return u(this,l,h).call(this,"view",{url:window.location.href})}lead(t,e,n={}){let i={...n,value:t,currency:e},s=new S(a(o,A));return u(this,l,h).call(this,"lead",s.sanitize(i))}product(t,e,n={}){let i={...n,value:t,currency:e},s=new S(a(o,g));return u(this,l,h).call(this,"product",s.sanitize(i))}addToCart(t,e,n,i={}){let s={...i,value:t,currency:e,quantity:n},M=new S(a(o,w));return u(this,l,h).call(this,"add_to_cart",M.sanitize(s))}checkout(t,e,n={}){let i={...n,value:t,currency:e},s=new S(a(o,p));return u(this,l,h).call(this,"checkout",s.sanitize(i))}code(t,e){return u(this,l,h).call(this,"code",{code:t.toString(),type:e.toString()})}purchase(t,e,n,i={}){let s={...i,value:t,currency:e,id:n},M=new S(a(o,E));return u(this,l,h).call(this,"purchase",M.sanitize(s))}emit(t,...e){if(!!["conf","view","identify","lead","product","addToCart","checkout","code","purchase"].includes(t))return this[t](...e)}},d=o;y=new WeakMap,f=new WeakMap,A=new WeakMap,g=new WeakMap,w=new WeakMap,p=new WeakMap,E=new WeakMap,l=new WeakSet,h=function(t,e){if(!this.token||!this.token.length)throw new Error("MAI SDK has not been configured. Call conf() first.");return this.ready.then(()=>{let n={...e,token:this.token,referrer:window.document.referrer};this.debug&&console.log("Sending sanitized payload:",n);let i=new XMLHttpRequest;i.open("POST",`${o.PIXEL_HOST}/${t}`,!0),i.setRequestHeader("Content-Type","application/json"),i.withCredentials=!0,i.onload=u(this,I,N),i.onerror=u(this,C,v),i.send(JSON.stringify(n))})},I=new WeakSet,N=function(){this.debug&&console.log("OK")},C=new WeakSet,v=function(t){this.debug&&console.log("XHR error:",t)},z(d,"PIXEL_HOST","https://mgln.ai"),c(d,y,{value:Number,currency:String}),c(d,f,{productId:String,productName:String,productType:String,productVendor:String,variantId:String,variantName:String}),c(d,A,{...a(o,y),id:String,productId:String,quantity:Number,type:String,category:String}),c(d,g,{...a(o,y),...a(o,f)}),c(d,w,{...a(o,g),quantity:Number}),c(d,p,{...a(o,y),quantity:Number,discountCode:String,id:String,lineItems:[a(o,w)]}),c(d,E,{...a(o,p),isNewCustomer:Boolean});q.exports=d});var x=L();if(window.MAI===void 0){let r=document.currentScript,t=r.dataset,e=new URL(r.src).searchParams,n=t.hasOwnProperty("token")?t.token:e.get("token"),i=t.hasOwnProperty("onboardingSync")?t.onboardingSync!=="false":e.get("onboarding_sync")!=="false";window.MAI=new x,window.MAI.conf(n,i)}else if(Array.isArray(window.MAI.q)){let r=window.MAI.q;window.MAI=new x,r.sort((t,e)=>(t[0]==="conf"?0:1)-(e[0]==="conf"?0:1)).forEach(t=>window.MAI.emit(...t))}})();
